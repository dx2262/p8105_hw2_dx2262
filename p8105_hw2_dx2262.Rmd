---
title: "p8105_hw2_dx2262"
output: github_document
---

```{r}
library(tidyverse)
library(readxl)
```


## Problem 2

Load the dataset

Mr. Trash Wheel:
```{r}
Mr_df <- 
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = 1, 
             skip = 1, 
             na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  select(-x15, -x16) %>% 
  mutate(sports_balls = as.integer(round(sports_balls, 0)),
         wheel = "mr",
         year = as.numeric(year)) %>% 
  relocate(wheel, everything())
  
```

Professor Trash Wheel:
```{r}
Prof_df <- 
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = 2, 
             skip = 1, 
             na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  mutate(wheel = "prof",
         year = as.numeric(year)) %>% 
  relocate(wheel, everything())
```

Gwynns:
```{r}
GF_df <- 
  read_excel("data/202509 Trash Wheel Collection Data.xlsx", 
             sheet = 4, 
             skip = 1, 
             na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  mutate(wheel = "gwynns",
         year = as.numeric(year)) %>% 
  relocate(wheel, everything())
```

Combine datasets

```{r}
TrashWheel_df <- bind_rows(Mr_df, Prof_df, GF_df)
```

The total number of observations in the resulting dataset is 1191.

Key variables are `r paste(names(TrashWheel_df), collapse = ", ")`.

The total weight of trash collected by Professor Trash Wheel is `r Prof_df %>% pull(weight_tons) %>% sum(na.rm = TRUE)`

The total number of cigarette butts collected by Gwynns in June of 2022 is `r GF_df %>% filter(year == 2022, month == "June") %>% pull(cigarette_butts) %>% sum(na.rm = TRUE)`.


## Problem 3

Load datasets

```{r}
zip_codes_df <- 
  read.csv("data/Zip Codes.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names()
```

```{r}
housing_df <- 
  read.csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols = x2015_01_31:x2024_08_31,
    names_to = "date",
    values_to = "price",
    names_prefix = "x"
  ) %>% 
  drop_na() %>% 
  rename(
    zip_code = region_name
  )
```

Combine datasets

```{r}
housing_by_zip_df <- 
  left_join(housing_df, zip_codes_df, by = "zip_code") %>% 
  relocate(zip_code, size_rank, date, price, everything())
```

The total number of observations is 10677.

There are `r housing_by_zip_df %>% pull(zip_code) %>% n_distinct()` unique ZIP codes, and 
`r housing_by_zip_df %>% pull(neighborhood) %>% n_distinct()` unique neighborhoods.

Which ZIP codes appear in the ZIP code dataset but not in the Zillow Rental Price dataset? Using a few illustrative examples discuss why these ZIP codes might be excluded from the Zillow dataset.

```{r}
missing_zip <- 
  anti_join(zip_codes_df, housing_df, by = "zip_code") %>% 
  distinct(zip_code) %>% 
  pull(zip_code)

missing_zip
```

These zip codes might denotes sparsely populated or remote areas, as Zillowâ€™s data is mainly based on active rental markets and available listings. If a ZIP code has very few or no rental properties, data may be missing. The fact that these ZIP codes are all associated with neighborhoods Northest Bronx, Southern Brooklyn, etc. further corroborates this explanation.

```{r}
jan_prices <- housing_by_zip_df %>%
  filter(substr(date, 1, 7) %in% c("2020_01", "2021_01")) %>%
  select(zip_code, county, neighborhood, date, price) %>% 
  pivot_wider(
    names_from = date,
    values_from = price
  ) %>% 
  mutate(price_drop = `2020_01_31` - `2021_01_31`) %>% 
  knitr::kable()
jan_prices
```

Most ZIP codes experienced a significant drop, with the largest decrease exceeding nine hundred dollars, occurring in Lower Manhattan. However, since its original price was also high, the percentage decrease is comparable to other areas.



